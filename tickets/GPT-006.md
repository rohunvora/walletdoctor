# GPT-006: CI integration tests

**Priority**: P1  
**Owner**: TBD  
**Created**: 2025-01-02  
**Parent**: GPT-000  

## Goal
Implement automated CI tests that validate the trades export endpoint daily, ensuring GPT integration remains stable and catching regressions early.

## Acceptance Criteria
- [ ] GitHub Action runs daily against Railway staging/production
- [ ] Tests smoke wallet returns HTTP 200
- [ ] Tests validate JSON structure matches schema
- [ ] Tests check response time <10 seconds
- [ ] Failures post alert to #alerts channel
- [ ] Green check visible in GitHub repo

## Out of Scope
- Load testing or performance benchmarks
- Testing other endpoints
- Complex integration scenarios
- Manual test execution

## Testing
- [ ] CI test can be triggered manually
- [ ] Test passes with current production endpoint
- [ ] Test fails appropriately with mock bad response
- [ ] Slack/Discord webhook confirmed working

## Implementation Notes
GitHub Action structure:
```yaml
name: GPT Integration Tests
on:
  schedule:
    - cron: '0 9 * * *'  # Daily at 9 AM UTC
  workflow_dispatch:  # Manual trigger

jobs:
  test-trades-endpoint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Test Trades Export Endpoint
        env:
          API_KEY: ${{ secrets.WD_API_KEY }}
          WALLET: "34zYDgjy8oinZ5y8gyrcQktzUmSfFLJztTSq5xLUVCya"
        run: |
          # Test endpoint
          RESPONSE=$(curl -s -w "\n%{http_code}" \
            -H "X-Api-Key: $API_KEY" \
            "https://web-production-2bb2f.up.railway.app/v4/trades/export-gpt/$WALLET")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          JSON_BODY=$(echo "$RESPONSE" | sed '$d')
          
          # Validate HTTP 200
          if [ "$HTTP_CODE" != "200" ]; then
            echo "âŒ HTTP $HTTP_CODE"
            exit 1
          fi
          
          # Validate JSON structure
          echo "$JSON_BODY" | jq -e '.wallet, .signatures, .trades' > /dev/null
          
      - name: Alert on Failure
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: "GPT Integration test failed!"
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## Definition of Done
Daily CI job successfully monitoring trades endpoint health with automated alerts on failures, providing confidence that GPT integration remains stable. 